FROM node:18-alpine

WORKDIR /workspace

# Install git and bash for script execution
RUN apk add --no-cache git bash jq

# Install Claude Code SDK (when available)
# For now, we'll use a script-based approach
RUN npm install -g typescript ts-node

# Copy orchestration scripts
COPY scripts/orchestrate-phase2.ts /workspace/scripts/
COPY scripts/monitor-phase2.sh /workspace/scripts/
COPY phase2-infrastructure-audit.sh /workspace/

# Copy package.json for dependencies
COPY package*.json ./
RUN npm ci

# Set up communication directory
RUN mkdir -p /communication

ENTRYPOINT ["ts-node"]
CMD ["scripts/orchestrate-phase2.ts"]