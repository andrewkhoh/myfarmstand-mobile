FROM node:18-alpine

WORKDIR /workspace

# Install required tools
RUN apk add --no-cache git bash python3 py3-pip

# Install Claude CLI (when available)
# For now, we'll create a mock implementation
RUN npm install -g typescript ts-node @anthropic-ai/sdk

# Copy the entire workspace (will be overridden by volume mount)
COPY . .

# Install project dependencies
RUN npm ci

# Create agent execution script
COPY scripts/claude-agent-executor.ts /workspace/scripts/

# Set environment for Claude Code
ENV CLAUDE_CODE_MODE=automated
ENV CLAUDE_CODE_CONTEXT=/workspace

ENTRYPOINT ["ts-node"]
CMD ["scripts/claude-agent-executor.ts"]